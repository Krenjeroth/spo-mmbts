import{c as A,_ as X,a as z,b as re}from"./CEBnf4lY.js";import{m as ne}from"./Dlg-WL5g.js";import{d as G,$ as D,z as v,b as Y,o as S,w as r,g as l,a2 as J,X as e,p as x,e as q,t as M,c as O,a3 as K,v as ie,a6 as le,Y as se,al as de,I as j}from"#entry";import{b as ce}from"./BHpSMavt.js";import{u as pe}from"./STx5ny5w.js";import{u as Q}from"./EYerQBAz.js";import{_ as L}from"./BSWBmhT_.js";import{_ as W}from"./HtYbEshO.js";import{_ as Z,a as ee}from"./Bd0EK6v7.js";import{C as ue,U as me}from"./bFcEm6fe.js";import{u as te}from"./D6l_iJzJ.js";import"./D3Dcj_v8.js";import"./DpB_hE1g.js";import"./CGL4pY6L.js";import"./DpIK6lhX.js";import"./bPUzXHqf.js";import"./Bgk1oRip.js";const ge={class:"truncate"},_e={key:0,class:"text-gray-400"},fe={key:1,class:"text-gray-400"},Ce=G({__name:"CreateModal",props:{pageTitle:String},emits:["reloadTable","success","error","close"],setup(F,{emit:y}){const m=Q(),{parentCriteria:U,loading:h,errorBag:d,hasError:f}=D(m);m.fetchParentCriteria();const s=te(),{categories:I,categoriesSelect:$,loading:c}=D(s);s.fetchCategories(),s.fetchCategoriesSelect();const n=y,C=F,V=()=>n("close"),E=()=>{n("success"),n("reloadTable"),V()},b=()=>{n("error")},a=v({category_id:void 0,parent_id:void 0,name:void 0,percentage:void 0}),P=async p=>{if(p.data.parent_id=p.data.parent_id?.id,await m.addCriterion(p.data),f.value){b();return}E()},B=v(U.value),_=v(""),N=async p=>{if(_.value=p,!_.value||_.value.length<2)return[];const t=await m.fetchParentCriteriaSearch(_.value);return B.value=t,t};return(p,t)=>{const k=A,o=L,i=W,w=ee,T=K,H=Z,R=X;return S(),Y(R,{"on-close":V,title:`Create ${C.pageTitle}`},{default:r(()=>[l(H,{schema:"CreateCriterionValidationSchema"in p?p.CreateCriterionValidationSchema:e(ue),state:e(a),onSubmit:J(P,["prevent"]),class:"space-y-6"},{default:r(()=>[l(o,{label:"Category",name:"category_id",error:e(d).category_id,ui:{wrapper:"md:w-full"}},{default:r(()=>[l(k,{modelValue:e(a).category_id,"onUpdate:modelValue":t[0]||(t[0]=u=>e(a).category_id=u),options:e($),searchable:!0,loading:e(c),placeholder:"Type to search...","value-attribute":"id","option-attribute":"event_category"},{"option-empty":r(({query:u})=>[q("q",null,M(u),1),t[4]||(t[4]=x(" not found ",-1))]),empty:r(()=>[...t[5]||(t[5]=[x(" No category found ",-1)])]),_:1},8,["modelValue","options","loading"])]),_:1},8,["error"]),l(o,{label:"Parent (Optional)",name:"parent_id",error:e(d).parent_id,ui:{wrapper:"md:w-full"}},{default:r(()=>[l(i,{modelValue:e(a).parent_id,"onUpdate:modelValue":t[1]||(t[1]=u=>e(a).parent_id=u),search:N,loading:e(h),placeholder:"Type to search...","option-attribute":"search_name"},{option:r(({option:u})=>[q("span",ge,M(u.search_name),1)]),empty:r(()=>[e(_).length<2?(S(),O("span",_e,"Type at least 2 characters...")):(S(),O("span",fe,"No "+M(C.pageTitle)+" found",1))]),_:1},8,["modelValue","loading"])]),_:1},8,["error"]),l(o,{label:"Criteria",name:"name",error:e(d).name},{default:r(()=>[l(w,{modelValue:e(a).name,"onUpdate:modelValue":t[2]||(t[2]=u=>e(a).name=u)},null,8,["modelValue"])]),_:1},8,["error"]),l(o,{label:"Percentage",name:"percentage",error:e(d).percentage},{default:r(()=>[l(w,{modelValue:e(a).percentage,"onUpdate:modelValue":t[3]||(t[3]=u=>e(a).percentage=u),type:"number",step:"0.1"},null,8,["modelValue"])]),_:1},8,["error"]),l(T,{type:"submit",loading:e(h)},{default:r(()=>[...t[6]||(t[6]=[x(" Add ",-1)])]),_:1},8,["loading"])]),_:1},8,["schema","state"])]),_:1},8,["title"])}}}),ye=Object.assign(Ce,{__name:"CriteriaCreateModal"}),he={class:"truncate"},be={key:0,class:"text-gray-400"},ve={key:1,class:"text-gray-400"},Se=G({__name:"UpdateModal",props:{pageTitle:String,criterion:Object},emits:["reloadTable","success","error","noDataChange","close"],setup(F,{emit:y}){const m=Q(),{parentCriteria:U,loading:h,errorBag:d,hasError:f}=D(m);m.fetchParentCriteria();const s=te(),{categories:I,loading:$}=D(s);s.fetchCategories();const c=y,n=F,C=()=>c("close"),V=()=>{c("success"),c("reloadTable"),C()},E=()=>{c("error")},b=()=>{c("noDataChange")},a=v({category_id:n.criterion?.category_id||void 0,parent_id:n.criterion?.parent||void 0,name:n.criterion?.name||void 0,percentage:n.criterion?.percentage||void 0}),P=v({...z.cloneDeep({category_id:n.criterion?.category_id||void 0,parent_id:n.criterion?.parent||void 0,name:n.criterion?.name||void 0,percentage:n.criterion?.percentage||void 0})}),B=["category_id","parent_id","name","percentage"],_=ie(()=>B.some(o=>{const i=a.value[o],w=P.value[o];return!z.isEqual(i,w)})),N=async o=>{if(!_.value){b();return}if(o.data.parent_id=o.data.parent_id?.id,await m.updateCriterion(n.criterion?.id,o.data),f.value){E();return}V()},p=v(U.value),t=v(""),k=async o=>{if(t.value=o,!t.value||t.value.length<2)return[];const i=await m.fetchParentCriteriaSearch(t.value);return p.value=i,i};return(o,i)=>{const w=A,T=L,H=W,R=ee,u=K,oe=Z,ae=X;return S(),Y(ae,{"on-close":C,title:`Update ${n.pageTitle}`},{default:r(()=>[l(oe,{schema:"UpdateCriterionValidationSchema"in o?o.UpdateCriterionValidationSchema:e(me),state:e(a),onSubmit:J(N,["prevent"]),class:"space-y-6"},{default:r(()=>[l(T,{label:"Category",name:"category_id",error:e(d).category_id,ui:{wrapper:"md:w-full"}},{default:r(()=>[l(w,{modelValue:e(a).category_id,"onUpdate:modelValue":i[0]||(i[0]=g=>e(a).category_id=g),options:e(I),searchable:!0,loading:e($),placeholder:"Type to search...","value-attribute":"id","option-attribute":"event_category"},{"option-empty":r(({query:g})=>[q("q",null,M(g),1),i[4]||(i[4]=x(" not found ",-1))]),empty:r(()=>[...i[5]||(i[5]=[x(" No category found ",-1)])]),_:1},8,["modelValue","options","loading"])]),_:1},8,["error"]),l(T,{label:"Parent (Optional)",name:"parent_id",error:e(d).parent_id,ui:{wrapper:"md:w-full"}},{default:r(()=>[l(H,{modelValue:e(a).parent_id,"onUpdate:modelValue":i[1]||(i[1]=g=>e(a).parent_id=g),search:k,loading:e(h),placeholder:"Type to search...","option-attribute":"search_name"},{option:r(({option:g})=>[q("span",he,M(g.search_name),1)]),empty:r(()=>[e(t).length<2?(S(),O("span",be,"Type at least 2 characters...")):(S(),O("span",ve,"No "+M(n.pageTitle)+" found",1))]),_:1},8,["modelValue","loading"])]),_:1},8,["error"]),l(T,{label:"Criteria",name:"name",error:e(d).name},{default:r(()=>[l(R,{modelValue:e(a).name,"onUpdate:modelValue":i[2]||(i[2]=g=>e(a).name=g)},null,8,["modelValue"])]),_:1},8,["error"]),l(T,{label:"Percentage",name:"percentage",error:e(d).percentage},{default:r(()=>[l(R,{modelValue:e(a).percentage,"onUpdate:modelValue":i[3]||(i[3]=g=>e(a).percentage=g),type:"number",step:"0.1"},null,8,["modelValue"])]),_:1},8,["error"]),l(u,{type:"submit",loading:e(h),disabled:!e(_)},{default:r(()=>[...i[6]||(i[6]=[x(" Update ",-1)])]),_:1},8,["loading","disabled"])]),_:1},8,["schema","state"])]),_:1},8,["title"])}}}),Ue=Object.assign(Se,{__name:"CriteriaUpdateModal"}),qe=G({__name:"index",setup(F){const y=le();se({title:()=>y.meta.title});const{strSingular:m}=ce(),U=m(y.meta.title),h=y.meta.title,d=de(),{actionToastResult:f}=pe(),s=Q(),{criteria:I,loading:$,page:c,pageCount:n,search:C,sort:V,totalCriteria:E,selectedStatus:b}=D(s),{columns:a,items:P,statusOptions:B}=ne;s.fetchCriteria();const _=()=>{d.open(ye,{pageTitle:U,onReloadTable(){s.fetchCriteria()},onSuccess(){f({icon:"i-heroicons-check-circle",description:"Event created.",id:"modal-success",color:"green"})},onError(){f({icon:"i-heroicons-x-circle",description:"Something went wrong.",id:"modal-error",color:"red"})},onClose(){d.close()}})},N=p=>{d.open(Ue,{pageTitle:U,criterion:p,onReloadTable(){s.fetchCriteria()},onSuccess(){f({icon:"i-heroicons-check-circle",description:"Event updated.",id:"modal-success",color:"green"})},onError(){f({icon:"i-heroicons-x-circle",description:"Something went wrong.",id:"modal-error",color:"red"})},onNoDataChange(){f({icon:"i-heroicons-exclamation-circle",description:"No data changes detected.",id:"modal-warning",color:"yellow"})},onClose(){d.close()}})};return j(C,()=>{c.value=1,s.fetchCriteria()}),j(n,()=>{c.value=1,s.fetchCriteria()}),j([c,n],()=>{s.fetchCriteria()}),j(b,()=>{c.value=1,s.fetchCriteria()}),(p,t)=>{const k=re;return S(),O("div",null,[l(k,{"module-title":e(h),columns:e(a),"action-items":e(P),"table-data":e(I),"add-data-modal":_,loading:e($),"action-handlers":{edit:N},pagination:{page:e(c),pageCount:e(n),total:e(E)},sorting:e(V),search:e(C),"selected-dropdown-filter":e(b),"enable-dropdown-filter":!0,"dropdown-filter-options":e(B),"onUpdate:page":t[0]||(t[0]=o=>c.value=o),"onUpdate:pageCount":t[1]||(t[1]=o=>n.value=o),"onUpdate:sort":e(s).fetchCriteria,"onUpdate:search":t[2]||(t[2]=o=>C.value=o),"onUpdate:selectedDropdownFilter":t[3]||(t[3]=o=>b.value=o)},null,8,["module-title","columns","action-items","table-data","loading","action-handlers","pagination","sorting","search","selected-dropdown-filter","dropdown-filter-options","onUpdate:sort"])])}}});export{qe as default};
