import{v as $,a4 as _,z as o}from"#entry";import{u as U}from"./bPUzXHqf.js";import{u as b,a as B}from"./BHpSMavt.js";function C(){const r=U(),{apiUrl:h}=b(),i="phases",c=$(()=>h(i));return{fetchPhasesApi:async a=>await r(`${c.value}?${a.toString()}`),fetchPhaseApi:async a=>await r(`${c.value}/${a}`),addPhaseApi:async a=>await r(`${c.value}`,{method:"POST",body:a}),updatePhaseApi:async(a,s)=>await r(`${c.value}/${a}`,{method:"PUT",body:s}),deletePhaseApi:async a=>await r(`${c.value}/${a}`,{method:"DELETE"})}}const x=_("phases",()=>{const{fetchPhasesApi:r,addPhaseApi:h,updatePhaseApi:i,deletePhaseApi:c}=C(),{hasError:v,errorBag:f,transformValidationErrors:n,resetErrorBag:l}=B();let d;(t=>{t.ASC="asc",t.DESC="desc"})(d||(d={}));const a=o([]),s=o(!1),y=o(1),m=o(5),g=o(""),w=o(""),p=o({column:"created_at",direction:"desc"}),P=o(0);return{phases:a,loading:s,hasError:v,errorBag:f,page:y,pageCount:m,search:g,selectedStatus:w,sort:p,totalPhases:P,fetchPhases:async()=>{s.value=!0,l();try{const t=new URLSearchParams({page:y.value.toString(),per_page:m.value.toString(),sort:p.value.column,order:p.value.direction,search:g.value}),e=await r(t);a.value=e.data,console.log(a.value),P.value=Number(e.meta.total)||0}catch(t){n(t)}finally{s.value=!1}},fetchPhasesByEvent:async t=>{s.value=!0,l();try{const e=new URLSearchParams({event_id:t.toString(),per_page:"999"}),u=await r(e),A=Array.isArray(u.data?.data)?u.data.data:u.data;a.value=(A||[]).map(S=>({...S,categories:S.categories||[]}));const E=u.data?.meta||{total:A?.length||0,per_page:999,current_page:1,last_page:1};console.info("✅ Phases loaded for event:",t,a.value),P.value=Number(E.total)||0}catch(e){console.error("❌ Failed to fetch phases:",e),n(e)}finally{s.value=!1}},addPhase:async t=>{s.value=!0,l();try{const e=await h(t);a.value.push(e.data??e)}catch(e){n(e)}finally{s.value=!1}},updatePhase:async(t,e)=>{s.value=!0,l(),await i(t,e).catch(u=>{n(u)}).finally(()=>{s.value=!1})},deletePhase:async t=>{s.value=!0,l();try{await c(t),a.value=a.value.filter(e=>e.id!==t)}catch(e){n(e)}finally{s.value=!1}}}});export{x as u};
