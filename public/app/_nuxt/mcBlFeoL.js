import{_ as ee,a as te}from"./D3Dcj_v8.js";import{_ as ae}from"./BSWBmhT_.js";import{v as se,a4 as oe,z as y,d as ne,Y as re,$ as V,a0 as le,I as M,c as A,o as k,e as l,f as H,g as v,w as u,X as b,a1 as X,j as K,b as ie,t as g,p as q,a3 as ce,n as Q}from"#entry";import{u as ue,a as de,_ as me}from"./BHpSMavt.js";import{_ as ge}from"./DpIK6lhX.js";import{u as ye}from"./2jTwVr-P.js";import{u as pe}from"./yF1_bWGY.js";import{u as _e}from"./D6l_iJzJ.js";import{u as fe}from"./bPUzXHqf.js";import{u as he}from"./8mhFFBPB.js";import{u as ve}from"./BOpyu-xB.js";import{u as be}from"./STx5ny5w.js";import{u as Ce}from"./BdHKa--D.js";import"./DpB_hE1g.js";function xe(){const C=fe(),{apiUrl:B}=ue(),E="category-results",f=se(()=>B(E));return{fetchCategoryResultsApi:async n=>await C(`${f.value}?${n.toString()}`),fetchCategoryResultApi:async n=>await C(`${f.value}/${n}`),addCategoryResultApi:async n=>await C(`${f.value}`,{method:"POST",body:n}),updateCategoryResultApi:async(n,d)=>await C(`${f.value}/${n}`,{method:"PUT",body:d}),deleteCategoryResultApi:async n=>await C(`${f.value}/${n}`,{method:"DELETE"})}}const Re=oe("category-results",()=>{const{fetchCategoryResultsApi:C,addCategoryResultApi:B,updateCategoryResultApi:E,deleteCategoryResultApi:f}=xe(),{hasError:J,errorBag:x,transformValidationErrors:h,resetErrorBag:p}=de();let w;(c=>{c.ASC="asc",c.DESC="desc"})(w||(w={}));const n=y([]),d=y(!1),j=y(1),z=y(5),$=y(""),N=y(""),U=y({column:"created_at",direction:"desc"}),F=y(0);return{categoryResults:n,loading:d,hasError:J,errorBag:x,page:j,pageCount:z,search:$,selectedStatus:N,sort:U,totalScore:F,fetchCategoryResults:async()=>{d.value=!0,p();try{const c=new URLSearchParams({page:j.value.toString(),per_page:z.value.toString(),sort:U.value.column,order:U.value.direction,search:$.value}),e=await C(c);n.value=e.data??e,console.log(n.value),F.value=Number(e.meta.total)||0}catch(c){h(c)}finally{d.value=!1}},fetchCategoryResultsByEvent:async c=>{d.value=!0,p();try{const e=new URLSearchParams({event_id:c.toString(),per_page:"999"}),R=await C(e);n.value=R.data??R,console.log(R,n.value),F.value=Number(R.meta.total)||0}catch(e){h(e)}finally{d.value=!1}},addCategoryResult:async c=>{d.value=!0,p();try{const e=await B(c);n.value.push(e.data??e)}catch(e){h(e)}finally{d.value=!1}},updateCategoryResult:async(c,e)=>{d.value=!0,p(),await E(c,e).catch(R=>{h(R)}).finally(()=>{d.value=!1})},deleteCategoryResult:async c=>{d.value=!0,p();try{await f(c),n.value=n.value.filter(e=>e.id!==c)}catch(e){h(e)}finally{d.value=!1}}}}),ke={class:"space-y-6"},we={class:"flex justify-between items-center"},Se={key:0},Ae={class:"text-xl font-semibold mb-2"},Ne={class:"text-lg font-semibold"},Pe={class:"flex items-center gap-3"},Be={class:"text-sm text-gray-500"},Ee={class:"flex items-center gap-3"},$e={class:"flex items-center gap-2"},Ue={key:0},Fe={class:"font-medium"},Ve={class:"font-semibold"},Je={class:"font-semibold text-right block"},Te={class:"font-semibold text-right block"},je={key:1},De={class:"font-medium"},Le={class:"font-semibold"},He={class:"font-semibold text-right block"},ze={class:"font-semibold text-right block"},Ge={key:2,class:"text-gray-500 italic text-sm text-center p-4 border rounded-md bg-gray-50 mt-2"},Me={key:1,class:"text-gray-500 italic text-sm text-center p-4 border rounded-md bg-gray-50 mt-2"},qe={key:1,class:"text-gray-500 italic p-4"},Oe={key:2,class:"text-center text-gray-400 py-6"},W=1,lt=ne({__name:"index",setup(C){re({title:"Category Results"});const B=ye(),E=pe(),f=_e(),J=Re(),x=he(),{events:h}=V(B),{phases:p}=V(E),{categories:w}=V(f),{categoryResults:n,loading:d}=V(J),{judges:j,loading:z}=V(x),$=ve(),N=y(null),{actionToastResult:U}=be(),F=y({}),D=y({}),P=y({}),G=Ce(),{contestants:O}=V(G);le(async()=>{await B.fetchEvents(),h.value.length&&(N.value=h.value[0].id)});function Y(o){return(D.value[o]??[]).map(r=>({label:r.user?.name||r.name||`Judge ${r.judge_number??""}`,value:Number(r.id)}))}async function c(o){const s=P.value[o];if(s)try{await $.printPerJudge(o,s,W),U({title:"Generating printable...",description:"Your per-judge PDF will open shortly.",color:"primary"})}catch(r){U({title:"Download failed",description:r?.message||"Please retry later.",color:"red"})}}M(N,async o=>{o&&await Promise.all([E.fetchPhasesByEvent(o),f.fetchCategoriesByEvent(o),J.fetchCategoryResultsByEvent(o),G.fetchContestantsByEvent?.(o)])}),M(n,o=>{console.log("ðŸ“Š Category Results Received:",o)});const e=(o,s)=>(n.value||[]).filter(r=>Number(r.category_id)===Number(o)&&(r.contestant_gender||"").toLowerCase()===s.toLowerCase()).map(I).sort((r,_)=>Number(r.number)-Number(_.number)),R=[{key:"number",label:"No."},{key:"municipality",label:"Municipality"},{key:"average_score",label:"Average Score",class:"text-right"},{key:"category_total",label:"Total Score",class:"text-right"},{key:"rank",label:"Rank",class:"text-right"}];M(()=>({phases:p.value,categories:w.value}),async({phases:o,categories:s})=>{!o?.length||!s?.length||await Promise.all(o.map(async r=>{try{const _=s.find(i=>i.phase_id===r.id);let S=[];if(x.fetchJudgesByPhase){const i=await x.fetchJudgesByPhase(r.id);S=(Array.isArray(i)&&i.length?i:x.judgesByPhase?.[r.id])??[]}else if(_){const i=await x.fetchJudgesByCategory(_.id);S=(Array.isArray(i)&&i.length?i:x.judgesByCategory?.[_.id])??j.value??[]}F.value[r.id]=S,s.filter(i=>i.phase_id===r.id).forEach(i=>{D.value[i.id]=S;const T=P.value[i.id];T&&!S.some(L=>Number(L.id)===Number(T))&&(P.value[i.id]=void 0)})}catch{F.value[r.id]=[],s.filter(_=>_.phase_id===r.id).forEach(_=>D.value[_.id]=[])}}))},{immediate:!0});const Z=o=>(O.value||[]).find(s=>Number(s.id)===Number(o)),I=o=>{const s=Z(o.contestant_id);return{...o,municipality:s?.municipality??s?.lgu??"",number:s?.number??""}};return(o,s)=>{const r=ee,_=ae,S=ce,i=te,T=me,L=ge;return k(),A("div",ke,[l("div",we,[v(_,{label:"Select Active Event"},{default:u(()=>[v(r,{modelValue:N.value,"onUpdate:modelValue":s[0]||(s[0]=m=>N.value=m),options:b(h).map(m=>({label:m.title,value:m.id})),placeholder:"Choose event",class:"w-72"},null,8,["modelValue","options"])]),_:1})]),N.value&&b(p)?.length?(k(),A("div",Se,[v(L,{items:b(p).map(m=>({label:m.name,icon:"i-heroicons-flag",slot:`phase-${m.id}`}))},X({_:2},[K(b(p),m=>({name:`phase-${m.id}`,fn:u(()=>[v(T,{class:"p-4 space-y-6"},{default:u(()=>[l("div",Ae,g(m.name),1),b(w).filter(t=>t.phase_id===m.id).length?(k(),ie(L,{key:0,items:b(w).filter(t=>t.phase_id===m.id).map(t=>({label:`${t.name} (${t.weight}%)`,icon:"i-heroicons-sparkles",slot:`category-${t.id}`}))},X({_:2},[K(b(w).filter(t=>t.phase_id===m.id),t=>({name:`category-${t.id}`,fn:u(()=>[v(T,{class:"p-4 space-y-4"},{default:u(()=>[l("div",Ne,[l("div",Pe,[q(g(t.name)+" ",1),l("span",Be," ("+g(t.weight)+"%) ",1)]),l("div",Ee,[v(S,{disabled:b($).isDownloading||!e(t.id,"female").length&&!e(t.id,"male").length,onClick:a=>b($).printCategory(t.id,W),class:"btn btn-outline btn-sm"},{default:u(()=>[...s[1]||(s[1]=[q(" ðŸ–¨ï¸ Download Summary ",-1)])]),_:1},8,["disabled","onClick"]),l("div",$e,[v(r,{modelValue:P.value[t.id],"onUpdate:modelValue":a=>P.value[t.id]=a,options:Y(t.id),placeholder:"Select Judge",class:"w-56"},null,8,["modelValue","onUpdate:modelValue","options"]),v(S,{icon:"i-heroicons-printer",color:"primary",variant:"solid",size:"sm",disabled:!P.value[t.id]||!e(t.id,"female").length&&!e(t.id,"male").length,onClick:a=>c(t.id)},{default:u(()=>[...s[2]||(s[2]=[q(" Per-Judge PDF ",-1)])]),_:1},8,["disabled","onClick"])])])]),e(t.id,"female").length?(k(),A("div",Ue,[s[3]||(s[3]=l("div",{class:"font-medium mt-2 mb-2 text-pink-500"}," Female ",-1)),v(i,{columns:R,rows:e(t.id,"female")},{"municipality-data":u(({row:a})=>[l("span",Fe,g(a.municipality),1)]),"number-data":u(({row:a})=>[l("span",Ve,g(a.number),1)]),"average_score-data":u(({row:a})=>[l("span",Je,g(Number(a.average_score).toFixed(5)),1)]),"category_total-data":u(({row:a})=>[l("span",Te,g(Number(a.category_total).toFixed(5)),1)]),"rank-data":u(({row:a})=>[l("span",{class:Q(["font-semibold text-right block",{"font-bold text-yellow-500":a.rank===1,"font-semibold text-gray-500":a.rank===2,"font-medium text-gray-400":a.rank===3}])},g(a.rank),3)]),_:1},8,["rows"])])):H("",!0),e(t.id,"male").length?(k(),A("div",je,[s[4]||(s[4]=l("div",{class:"font-medium mt-2 mb-2 text-blue-500"},"Male",-1)),v(i,{columns:R,rows:e(t.id,"male")},{"municipality-data":u(({row:a})=>[l("span",De,g(a.municipality),1)]),"number-data":u(({row:a})=>[l("span",Le,g(a.number),1)]),"average_score-data":u(({row:a})=>[l("span",He,g(Number(a.average_score).toFixed(5)),1)]),"category_total-data":u(({row:a})=>[l("span",ze,g(Number(a.category_total).toFixed(5)),1)]),"rank-data":u(({row:a})=>[l("span",{class:Q(["font-semibold text-right block",{"font-bold text-yellow-500":a.rank===1,"font-semibold text-gray-500":a.rank===2,"font-medium text-gray-400":a.rank===3}])},g(a.rank),3)]),_:1},8,["rows"])])):H("",!0),!e(t.id,"female").length&&!e(t.id,"male").length?(k(),A("div",Ge," No results available for this category yet. ")):H("",!0)]),_:2},1024)])}))]),1032,["items"])):(k(),A("div",Me," No categories found under this phase. "))]),_:2},1024)])}))]),1032,["items"])])):(k(),A("div",qe," Please select an event to view category results. ")),b(d)?(k(),A("div",Oe," Loading results... ")):H("",!0)])}}});export{lt as default};
