import{v as $,a4 as E,z as c}from"#entry";import{u as U}from"./bPUzXHqf.js";import{u as b,a as q}from"./BHpSMavt.js";function L(){const i=U(),{apiUrl:h}=b(),v="criteria",n=$(()=>h(v));return{fetchCriteriaApi:async t=>await i(`${n.value}?${t.toString()}`),fetchCriterionApi:async t=>await i(`${n.value}/${t}`),fetchParentCriteriaApi:async t=>await i(`${n.value}-parent?${t.toString()}`),fetchParentCriteriaSearchApi:async t=>{const l=t?.toString()||"";return await i(`${n.value}-parent-search?${l}`)},addCriterionApi:async t=>await i(`${n.value}`,{method:"POST",body:t}),updateCriterionApi:async(t,l)=>await i(`${n.value}/${t}`,{method:"PUT",body:l}),deleteCriterionApi:async t=>await i(`${n.value}/${t}`,{method:"DELETE"})}}const I=E("criteria",()=>{const{fetchCriteriaApi:i,fetchParentCriteriaApi:h,fetchParentCriteriaSearchApi:v,addCriterionApi:n,updateCriterionApi:S,deleteCriterionApi:A}=L(),{hasError:g,errorBag:P,transformValidationErrors:o,resetErrorBag:s}=q();let C;(r=>{r.ASC="asc",r.DESC="desc"})(C||(C={}));const t=c([]),l=c([]),a=c(!1),f=c(1),y=c(5),m=c(""),w=c(""),p=c({column:"created_at",direction:"desc"}),d=c(0);return{criteria:t,parentCriteria:l,loading:a,hasError:g,errorBag:P,page:f,pageCount:y,search:m,selectedStatus:w,sort:p,totalCriteria:d,fetchCriteria:async()=>{a.value=!0,s();try{const r=new URLSearchParams({page:f.value.toString(),per_page:y.value.toString(),sort:p.value.column,order:p.value.direction,search:m.value}),e=await i(r);t.value=e.data??e,console.log(t.value),d.value=Number(e.meta.total)||0}catch(r){o(r)}finally{a.value=!1}},fetchCriteriaByEvent:async r=>{a.value=!0,s();try{const e=new URLSearchParams({event_id:r.toString(),per_page:"999"}),u=await i(e);t.value=u.data??u,console.log(t.value),d.value=Number(u.meta.total)||0}catch(e){o(e)}finally{a.value=!1}},fetchParentCriteria:async()=>{a.value=!0,s();try{const r=new URLSearchParams({page:f.value.toString(),per_page:y.value.toString(),sort:p.value.column,order:p.value.direction,search:m.value}),e=await h(r);l.value=e.data??e,console.log(l.value),d.value=Number(e.meta.total)||0}catch(r){o(r)}finally{a.value=!1}},fetchParentCriteriaSearch:async r=>{try{const e=new URLSearchParams({q:r,limit:"50"});return(await v(e)).data}catch(e){return console.error("API Error:",e),[]}},addCriterion:async r=>{a.value=!0,s();try{const e=await n(r);t.value.push(e.data??e)}catch(e){o(e)}finally{a.value=!1}},updateCriterion:async(r,e)=>{a.value=!0,s(),await S(r,e).catch(u=>{o(u)}).finally(()=>{a.value=!1})},deleteCriterion:async r=>{a.value=!0,s();try{await A(r),t.value=t.value.filter(e=>e.id!==r)}catch(e){o(e)}finally{a.value=!1}}}});export{I as u};
