import{c as G,_ as Q,a as I,b as oe}from"./XCtYQKhb.js";import{m as te}from"./Dd4r_6xM.js";import{d as k,$ as A,z as B,I as M,a0 as ae,e as z,o as H,w as n,g as s,a2 as X,X as e,p as U,t as w,a as P,a3 as Y,v as O,a6 as se,Y as ne,al as re,c as le}from"#entry";import{b as de}from"./CFo5vVrQ.js";import{u as ie}from"./STx5ny5w.js";import{u as q}from"./6i_t7e7t.js";import{_ as K}from"./_9ZTpig7.js";import{_ as L,a as W}from"./C8qUqt0S.js";import{C as ue,U as ce}from"./SZpBFCWL.js";import{u as me}from"./C87MT8_t.js";import{u as Z}from"./DZ2uQVpg.js";import"./DKItBGiq.js";import"./DpB_hE1g.js";import"./CJ5zKL8B.js";import"./DRvGcOf2.js";import"./bPUzXHqf.js";import"./Bgk1oRip.js";const pe=k({__name:"CreateModal",props:{pageTitle:String},emits:["reloadTable","success","error","close"],setup($,{emit:S}){const a=q(),{loading:h,errorBag:f,hasError:E}=A(a),y=me(),{events:D,loading:b}=A(y);y.fetchEvents();const p=Z(),{phases:u,loading:J}=A(p);p.fetchPhases();const{availableUsersForActivePhases:N}=q(),c=B([]),g=B(!1),_=S,r=$,C=()=>_("close"),V=()=>{_("success"),_("reloadTable"),C()},T=()=>{_("error")},d=B({user_id:void 0,phase_ids:[],judge_number:void 0}),l=async i=>{if(console.log(i.data),await a.addJudge(i.data),E.value){T();return}V()},t=async i=>(await N({search:i??"",phase_ids:d.value.phase_ids,scope:"event",limit:25,exclude_roles:["administrator","tabulator"],require_role:"judge",exclude_self:!0})).map(j=>({id:j.value,name:j.label,email:j.hint}));return M(()=>d.value.phase_ids,async()=>{c.value=await t("")}),ae(async()=>{g.value=!0;try{c.value=await t("")}finally{g.value=!1}}),(i,o)=>{const j=G,x=K,F=W,R=Y,v=L,ee=Q;return H(),z(ee,{"on-close":C,title:`Create ${r.pageTitle}`},{default:n(()=>[s(v,{schema:"CreateJudgeValidationSchema"in i?i.CreateJudgeValidationSchema:e(ue),state:e(d),onSubmit:X(l,["prevent"]),class:"space-y-6"},{default:n(()=>[s(x,{label:"User",name:"user_id",error:e(f).user_id,ui:{wrapper:"md:w-full"}},{default:n(()=>[s(j,{modelValue:e(d).user_id,"onUpdate:modelValue":o[0]||(o[0]=m=>e(d).user_id=m),options:e(c),searchable:t,loading:e(g),placeholder:"Type to search...","value-attribute":"id","option-attribute":"name"},{"option-empty":n(({query:m})=>[P("q",null,w(m),1),o[4]||(o[4]=U(" not found ",-1))]),empty:n(()=>[U(" No "+w(r.pageTitle)+" found ",1)]),_:1},8,["modelValue","options","loading"])]),_:1},8,["error"]),s(x,{label:"Category Assignment (optional)",name:"category_assignment",error:e(f).category_assignment},{default:n(()=>[s(F,{modelValue:e(d).category_assignment,"onUpdate:modelValue":o[1]||(o[1]=m=>e(d).category_assignment=m),placeholder:"e.g., Q&A, Advocacy..."},null,8,["modelValue"])]),_:1},8,["error"]),s(x,{label:"Phase",name:"phase_ids",error:e(f).phase_ids,ui:{wrapper:"md:w-full"}},{default:n(()=>[s(j,{modelValue:e(d).phase_ids,"onUpdate:modelValue":o[2]||(o[2]=m=>e(d).phase_ids=m),options:e(u),searchable:!0,loading:e(J),placeholder:"Type to search...","value-attribute":"id","option-attribute":"event_phase",multiple:""},{"option-empty":n(({query:m})=>[P("q",null,w(m),1),o[5]||(o[5]=U(" not found ",-1))]),empty:n(()=>[U(" No "+w(r.pageTitle)+" found ",1)]),_:1},8,["modelValue","options","loading"])]),_:1},8,["error"]),s(x,{label:"Judge Number",name:"judge_number",error:e(f).judge_number},{default:n(()=>[s(F,{modelValue:e(d).judge_number,"onUpdate:modelValue":o[3]||(o[3]=m=>e(d).judge_number=m)},null,8,["modelValue"])]),_:1},8,["error"]),s(R,{type:"submit",loading:e(b)},{default:n(()=>[...o[6]||(o[6]=[U(" Add ",-1)])]),_:1},8,["loading"])]),_:1},8,["schema","state"])]),_:1},8,["title"])}}}),ge=Object.assign(pe,{__name:"JudgesCreateModal"}),_e={class:"text-xs mt-1 text-gray-500"},he={class:"flex justify-end gap-2"},fe=k({__name:"UpdateModal",props:{pageTitle:{},judge:{}},emits:["reloadTable","success","error","noDataChange","close"],setup($,{emit:S}){const a=$,h=S,f=q(),{loading:E,errorBag:y,hasError:D}=A(f),b=Z(),{phases:p,loading:u}=A(b);b.fetchPhases();const J=()=>h("close"),N=()=>{h("success"),h("reloadTable"),J()},c=()=>h("error"),g=()=>h("noDataChange"),_=O(()=>({judge_number:a.judge?.judge_number??null,category_assignment:a.judge?.category_assignment??"",is_active:a.judge?.is_active??!0,phase_ids:Array.isArray(a.judge?.phases)?a.judge.phases.map(l=>l.id):[]})),r=B({judge_number:a.judge?.judge_number??null,category_assignment:a.judge?.category_assignment??"",is_active:a.judge?.is_active??!0,phase_ids:Array.isArray(a.judge?.phases)?a.judge.phases.map(l=>l.id):[]}),C=B({...I.cloneDeep({judge_number:a.judge?.judge_number??null,category_assignment:a.judge?.category_assignment??"",is_active:a.judge?.is_active??!0,phase_ids:Array.isArray(a.judge?.phases)?a.judge.phases.map(l=>l.id):[]})}),V=["judge_number","category_assignment","is_active","phase_ids"],T=O(()=>V.some(l=>{const t=r.value[l],i=C.value[l];return!I.isEqual(t,i)}));M(()=>a.judge,()=>{r.value={..._.value}});const d=async l=>{if(!T.value){g();return}const t={judge_number:r.value.judge_number??null,category_assignment:r.value.category_assignment||null,is_active:r.value.is_active??!0,phase_ids:r.value.phase_ids||[]};if(await f.updateJudge(a.judge.id,t),D.value){c();return}N()};return(l,t)=>{const i=W,o=K,j=G,x=Y,F=L,R=Q;return H(),z(R,{"on-close":J,title:`Update ${a.pageTitle}`},{default:n(()=>[s(F,{schema:"UpdateJudgeValidationSchema"in l?l.UpdateJudgeValidationSchema:e(ce),state:e(r),onSubmit:X(d,["prevent"]),class:"space-y-6"},{default:n(()=>[s(o,{label:"User",name:"user",ui:{wrapper:"md:w-full"}},{default:n(()=>[s(i,{"model-value":a.judge?.user?.name,disabled:""},null,8,["model-value"]),P("p",_e," Email: "+w(a.judge?.user?.email),1)]),_:1}),s(o,{label:"Phase",name:"phase_ids",error:e(y).phase_ids,ui:{wrapper:"md:w-full"}},{default:n(()=>[s(j,{modelValue:e(r).phase_ids,"onUpdate:modelValue":t[0]||(t[0]=v=>e(r).phase_ids=v),options:e(p),searchable:!0,loading:e(u),placeholder:"Type to search...","value-attribute":"id","option-attribute":"event_phase",multiple:""},{"option-empty":n(({query:v})=>[P("q",null,w(v),1),t[3]||(t[3]=U(" not found ",-1))]),empty:n(()=>[U(" No "+w(a.pageTitle)+" found ",1)]),_:1},8,["modelValue","options","loading"])]),_:1},8,["error"]),s(o,{label:"Judge Number",name:"judge_number",error:e(y).judge_number},{default:n(()=>[s(i,{modelValue:e(r).judge_number,"onUpdate:modelValue":t[1]||(t[1]=v=>e(r).judge_number=v)},null,8,["modelValue"])]),_:1},8,["error"]),s(o,{label:"Category Assignment (optional)",name:"category_assignment",error:e(y).category_assignment},{default:n(()=>[s(i,{modelValue:e(r).category_assignment,"onUpdate:modelValue":t[2]||(t[2]=v=>e(r).category_assignment=v),placeholder:"e.g., Q&A, Advocacy..."},null,8,["modelValue"])]),_:1},8,["error"]),P("div",he,[s(x,{type:"submit",loading:e(E),disabled:!e(T)},{default:n(()=>[...t[4]||(t[4]=[U("Update",-1)])]),_:1},8,["loading","disabled"])])]),_:1},8,["schema","state"])]),_:1},8,["title"])}}}),be=Object.assign(fe,{__name:"JudgesUpdateModal"}),$e=k({__name:"index",setup($){const S=se();ne({title:()=>S.meta.title});const{strSingular:a}=de(),h=a(S.meta.title),f=S.meta.title,{columns:E,items:y,statusOptions:D}=te,b=re(),{actionToastResult:p}=ie(),u=q(),{judges:J,loading:N,page:c,pageCount:g,search:_,sort:r,totalJudges:C,selectedStatus:V}=A(u);u.fetchJudges();const T=()=>{b.open(ge,{pageTitle:h,onReloadTable(){u.fetchJudges()},onSuccess(){p({icon:"i-heroicons-check-circle",description:"Judge created.",id:"modal-success",color:"green"})},onError(){p({icon:"i-heroicons-x-circle",description:"Something went wrong.",id:"modal-error",color:"red"})},onClose(){b.close()}})},d=l=>{b.open(be,{pageTitle:h,judge:l,onReloadTable(){u.fetchJudges()},onSuccess(){p({icon:"i-heroicons-check-circle",description:"Judge updated.",id:"modal-success",color:"green"})},onError(){p({icon:"i-heroicons-x-circle",description:"Something went wrong.",id:"modal-error",color:"red"})},onNoDataChange(){p({icon:"i-heroicons-exclamation-circle",description:"No data changes detected.",id:"modal-warning",color:"yellow"})},onClose(){b.close()}})};return M(_,()=>{c.value=1,u.fetchJudges()}),M(g,()=>{c.value=1,u.fetchJudges()}),M([c,g],()=>{u.fetchJudges()}),M(V,()=>{c.value=1,u.fetchJudges()}),(l,t)=>{const i=oe;return H(),le("div",null,[s(i,{"module-title":e(f),columns:e(E),"action-items":e(y),"table-data":e(J),"add-data-modal":T,loading:e(N),"action-handlers":{edit:d},pagination:{page:e(c),pageCount:e(g),total:e(C)},sorting:e(r),search:e(_),"selected-dropdown-filter":e(V),"enable-dropdown-filter":!0,"dropdown-filter-options":e(D),"onUpdate:page":t[0]||(t[0]=o=>c.value=o),"onUpdate:pageCount":t[1]||(t[1]=o=>g.value=o),"onUpdate:sort":e(u).fetchJudges,"onUpdate:search":t[2]||(t[2]=o=>_.value=o),"onUpdate:selectedDropdownFilter":t[3]||(t[3]=o=>V.value=o)},null,8,["module-title","columns","action-items","table-data","loading","action-handlers","pagination","sorting","search","selected-dropdown-filter","dropdown-filter-options","onUpdate:sort"])])}}});export{$e as default};
