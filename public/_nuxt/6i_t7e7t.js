import{v as U,a4 as P,z as i}from"#entry";import{u as $}from"./bPUzXHqf.js";import{u as E,a as F}from"./CFo5vVrQ.js";function x(){const s=$(),{apiUrl:y}=E(),f="judges",o=U(()=>y(f));return{fetchJudgesApi:async e=>await s(`${o.value}?${e.toString()}`),fetchJudgeApi:async e=>await s(`${o.value}/${e}`),addJudgeApi:async e=>await s(`${o.value}`,{method:"POST",body:e}),updateJudgeApi:async(e,c)=>await s(`${o.value}/${e}`,{method:"PUT",body:c}),deleteJudgeApi:async e=>await s(`${o.value}/${e}`,{method:"DELETE"}),judgesOptions:async(e,c=50)=>await s(`${o.value}/options`,{params:{search:e,limit:c}}),availableJudgeUsers:async(e,c=25)=>await s(`${o.value}/available-users`,{params:{search:e,limit:c}}),availableUsersForActivePhasesApi:async e=>{const c=y("users")+"/available-for-active-phases",n=await s(c,{params:{search:e?.search??"",limit:e?.limit??25,scope:e?.scope??"phases",...e?.phase_ids?.length?{phase_ids:e.phase_ids}:{},...e?.exclude_roles?.length?{exclude_roles:e.exclude_roles}:{},...e?.require_role?{require_role:e.require_role}:{},...e?.exclude_self!=null?{exclude_self:e.exclude_self?1:0}:{}}});return Array.isArray(n)?n:Array.isArray(n?.data)?n.data:Array.isArray(n?.items)?n.items:[]}}}const H=P("judges",()=>{const{fetchJudgesApi:s,addJudgeApi:y,updateJudgeApi:f,deleteJudgeApi:o,availableUsersForActivePhasesApi:_}=x(),{hasError:w,errorBag:b,transformValidationErrors:d,resetErrorBag:g}=F();let m;(t=>{t.ASC="asc",t.DESC="desc"})(m||(m={}));const u=i([]),r=i(!1),e=i(1),c=i(5),n=i(""),S=i(""),A=i({column:"created_at",direction:"desc"}),h=i(0);return{judges:u,loading:r,hasError:w,errorBag:b,page:e,pageCount:c,search:n,selectedStatus:S,sort:A,totalJudges:h,fetchJudges:async()=>{r.value=!0,g();try{const t=new URLSearchParams({page:e.value.toString(),per_page:c.value.toString(),sort:A.value.column,order:A.value.direction,search:n.value}),a=await s(t);u.value=a.data,console.log(u.value),h.value=Number(a.meta.total)||0}catch(t){d(t)}finally{r.value=!1}},fetchJudgesByEvent:async t=>{r.value=!0,g();try{const a=new URLSearchParams({event_id:t.toString(),per_page:"999"}),l=await s(a),v=Array.isArray(l.data?.data)?l.data.data:l.data;u.value=(v||[]).map(p=>({...p,categories:p.categories||[]}));const J=l.data?.meta||{total:v?.length||0,per_page:999,current_page:1,last_page:1};console.info("✅ Judges loaded for event:",t,u.value),h.value=Number(J.total)||0}catch(a){console.error("❌ Failed to fetch judges:",a),d(a)}finally{r.value=!1}},fetchJudgesByCategory:async t=>{r.value=!0,g();try{const a=new URLSearchParams({category_id:t.toString(),per_page:"999"}),l=await s(a),v=Array.isArray(l.data?.data)?l.data.data:l.data;u.value=(v||[]).map(p=>({...p,categories:p.categories||[]}));const J=l.data?.meta||{total:v?.length||0,per_page:999,current_page:1,last_page:1};console.info("✅ Judges loaded for category:",t,u.value),h.value=Number(J.total)||0}catch(a){console.error("❌ Failed to fetch judges:",a),d(a)}finally{r.value=!1}},addJudge:async t=>{r.value=!0,g();try{const a=await y(t);u.value.push(a.data??a)}catch(a){d(a)}finally{r.value=!1}},updateJudge:async(t,a)=>{r.value=!0,g(),await f(t,a).catch(l=>{d(l)}).finally(()=>{r.value=!1})},deleteJudge:async t=>{r.value=!0,g();try{await o(t),u.value=u.value.filter(a=>a.id!==t)}catch(a){d(a)}finally{r.value=!1}},availableUsersForActivePhases:async t=>{try{return await _(t)}catch(a){return d(a),[]}}}});export{H as u};
