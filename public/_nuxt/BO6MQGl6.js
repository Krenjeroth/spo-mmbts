import{_ as D,a as G}from"./DKItBGiq.js";import{_ as H}from"./_9ZTpig7.js";import{v as L,a4 as M,z as x,d as j,Y as z,$ as w,a0 as Y,I as B,c as u,o as m,a as s,f as F,g as b,w as o,X as N,a3 as q,p as I,n as U,t as r}from"#entry";import{u as X,a as J,_ as K}from"./CFo5vVrQ.js";import{u as O}from"./C87MT8_t.js";import{u as Q}from"./bPUzXHqf.js";import{u as W}from"./B_VK1r6v.js";import{u as Z}from"./STx5ny5w.js";import{u as tt}from"./CYZtsaz0.js";function et(){const v=Q(),{apiUrl:d}=X(),p="final-results",l=L(()=>d(p));return{fetchFinalResultsByEventApi:async i=>{const f=new URLSearchParams({event_id:String(i)});return await v(`${l.value}?${f.toString()}`)},fetchFinalResultApi:async i=>await v(`${l.value}/${i}`)}}const nt=M("final-results",()=>{const{fetchFinalResultsByEventApi:v}=et(),{hasError:d,errorBag:p,transformValidationErrors:l,resetErrorBag:g}=J();let h;(a=>{a.ASC="asc",a.DESC="desc"})(h||(h={}));const i=x([]),f=x([]),_=x(!1),k=x(null);return{finalResults:i,top5Finalists:f,loading:_,hasError:d,errorBag:p,selectedEvent:k,fetchFinalResultsByEvent:async a=>{_.value=!0,g();try{const c=await v(a);console.log("ðŸ“¦ Final Results API response:",c),i.value=c.data?.final_rankings??[],f.value=c.data?.top5??[]}catch(c){l(c)}finally{_.value=!1}}}}),st={class:"space-y-6"},at={class:"flex justify-between items-center"},ot={key:0},lt={class:"flex justify-end"},it={key:0},rt={class:"font-semibold"},ct={class:"font-medium"},ut={class:"font-semibold text-right block"},mt={key:1},dt={class:"font-semibold"},pt={class:"font-medium"},ft={class:"font-semibold text-right block"},_t={key:2,class:"text-gray-500 italic text-sm text-center p-4 border rounded-md bg-gray-50"},yt={key:1,class:"text-gray-500 italic p-4"},bt={key:2,class:"text-center text-gray-400 py-6"},Et=j({__name:"index",setup(v){z({title:"Final Results"});const d=O(),p=nt(),{events:l}=w(d),{finalResults:g,top5Finalists:h,loading:i}=w(p),f=W(),{actionToastResult:_}=Z(),k=tt(),{contestants:S}=w(k),a=x(null);Y(async()=>{await d.fetchEvents(),l.value.length&&(a.value=l.value[0].id)}),B(a,async n=>{n&&await Promise.all([p.fetchFinalResultsByEvent(n),k.fetchContestantsByEvent?.(n)])}),B(g,n=>{console.log("ðŸ Final Results Received:",n)});const c=n=>(S.value||[]).find(e=>Number(e.id)===Number(n)),A=n=>{const e=c(n.contestant_id);return{...n,municipality:e?.municipality??e?.lgu??"",number:e?.number??""}},y=n=>(g.value||[]).filter(e=>(e.gender||"").toLowerCase()===n.toLowerCase()).map(A).sort((e,R)=>Number(e.number)-Number(R.number)),E=[{key:"number",label:"No."},{key:"municipality",label:"Municipality"},{key:"grand_total",label:"Grand Total Score",class:"text-right"},{key:"rank",label:"Rank",class:"text-right"}],P=async()=>{if(a.value)try{await f.printFinalSummary?.(a.value),_({title:"Generating final results printable...",description:"Your PDF will open shortly.",color:"primary"})}catch(n){_({title:"Download failed",description:n?.message||"Please retry later.",color:"red"})}};return(n,e)=>{const R=D,V=H,T=q,C=G,$=K;return m(),u("div",st,[s("div",at,[b(V,{label:"Select Active Event"},{default:o(()=>[b(R,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value=t),options:N(l).map(t=>({label:t.title,value:t.id})),placeholder:"Choose event",class:"w-72"},null,8,["modelValue","options"])]),_:1})]),a.value?(m(),u("div",ot,[b($,{class:"p-6 space-y-8"},{default:o(()=>[e[5]||(e[5]=s("div",{class:"text-2xl font-semibold mb-6 text-center"}," Final Rankings ",-1)),s("div",lt,[b(T,{onClick:e[1]||(e[1]=t=>P()),class:"btn btn-outline btn-sm"},{default:o(()=>[...e[2]||(e[2]=[I(" ðŸ–¨ï¸ Download Summary ",-1)])]),_:1})]),y("female").length?(m(),u("div",it,[e[3]||(e[3]=s("div",{class:"font-medium mb-2 text-pink-500 text-lg"},"Female",-1)),b(C,{columns:E,rows:y("female")},{"number-data":o(({row:t})=>[s("span",rt,r(t.number),1)]),"municipality-data":o(({row:t})=>[s("span",ct,r(t.municipality),1)]),"grand_total-data":o(({row:t})=>[s("span",ut,r(Number(t.grand_total).toFixed(5)),1)]),"rank-data":o(({row:t})=>[s("span",{class:U(["font-semibold text-right block",{"font-bold text-yellow-500":t.rank===1,"font-semibold text-gray-500":t.rank===2,"font-medium text-gray-400":t.rank===3}])},r(t.rank),3)]),_:1},8,["rows"])])):F("",!0),y("male").length?(m(),u("div",mt,[e[4]||(e[4]=s("div",{class:"font-medium mt-6 mb-2 text-blue-500 text-lg"},"Male",-1)),b(C,{columns:E,rows:y("male")},{"number-data":o(({row:t})=>[s("span",dt,r(t.number),1)]),"municipality-data":o(({row:t})=>[s("span",pt,r(t.municipality),1)]),"grand_total-data":o(({row:t})=>[s("span",ft,r(Number(t.grand_total).toFixed(5)),1)]),"rank-data":o(({row:t})=>[s("span",{class:U(["font-semibold text-right block",{"font-bold text-yellow-500":t.rank===1,"font-semibold text-gray-500":t.rank===2,"font-medium text-gray-400":t.rank===3}])},r(t.rank),3)]),_:1},8,["rows"])])):F("",!0),!y("female").length&&!y("male").length?(m(),u("div",_t," No final results available for this event yet. ")):F("",!0)]),_:1})])):(m(),u("div",yt," Please select an event to view final results. ")),N(i)?(m(),u("div",bt," Loading results... ")):F("",!0)])}}});export{Et as default};
