import{_ as F,a as O,b as K}from"./XCtYQKhb.js";import{m as Q}from"./DBVsQjaN.js";import{v as B,a4 as W,z as y,d as M,$ as A,e as P,o as R,w as v,g as l,a2 as k,X as e,a as $,ak as Z,a3 as H,p as j,a6 as ee,Y as oe,al as te,I as N,c as ae}from"#entry";import{u as se,a as re,b as ne}from"./CFo5vVrQ.js";import{u as le}from"./STx5ny5w.js";import{u as de}from"./bPUzXHqf.js";import{_ as I,a as q}from"./C8qUqt0S.js";import{_ as G}from"./_9ZTpig7.js";import{_ as J}from"./DKItBGiq.js";import{C as ie,U as ce}from"./CBJ2e7Ro.js";import{u as L}from"./ZsI_bTFI.js";import"./DpB_hE1g.js";import"./CJ5zKL8B.js";import"./DRvGcOf2.js";import"./Bgk1oRip.js";const ue=()=>{const w=de(),{apiUrl:h}=se(),S="users",_=B(()=>h(S));return{fetchUsersApi:async o=>await w(`${_.value}?${o.toString()}`),addUserApi:async o=>await w(`${_.value}`,{method:"POST",body:JSON.stringify(o)}),updateUserApi:async(o,a)=>await w(`${_.value}/${o}`,{method:"PUT",body:JSON.stringify(a)}),deleteUserApi:async o=>await w(`${_.value}/${o}`,{method:"DELETE"}),usersOptions:async(o,a=25)=>await w(`${_.value}/options`,{params:{search:o,limit:a}})}},D=W("users",()=>{const{fetchUsersApi:w,addUserApi:h,updateUserApi:S,deleteUserApi:_}=ue(),{hasError:u,errorBag:g,transformValidationErrors:s,resetErrorBag:b}=re();let d;(t=>{t.ASC="asc",t.DESC="desc"})(d||(d={}));const o=y([]),a=y(!1),V=y(1),m=y(5),C=y(""),i=y(""),p=y({column:"created_at",direction:"desc"}),c=y(0);return{users:o,loading:a,hasError:u,errorBag:g,page:V,pageCount:m,search:C,selectedStatus:i,sort:p,totalUsers:c,fetchUsers:async()=>{a.value=!0,b();try{const t=new URLSearchParams({page:V.value.toString(),per_page:m.value.toString(),sort:p.value.column,order:p.value.direction,search:C.value}),r=await w(t);o.value=r.data,c.value=Number(r.meta.total)||0}catch(t){s(t)}finally{a.value=!1}},addUser:async t=>{a.value=!0,b();try{const r=await h(t);o.value.push(r.data??r)}catch(r){s(r)}finally{a.value=!1}},updateUser:async(t,r)=>{a.value=!0,b(),await S(t,r).catch(n=>{s(n)}).finally(()=>{a.value=!1})},deleteUser:async t=>{a.value=!0,b();try{await _(t),o.value=o.value.filter(r=>r.id!==t)}catch(r){s(r)}finally{a.value=!1}}}}),me={class:"space-y-6 md:space-y-0 md:flex md:space-x-6"},pe={class:"space-y-6 md:space-y-0 md:flex md:space-x-6"},Ue=M({__name:"CreateModal",emits:["reloadTable","success","error","close"],setup(w,{emit:h}){const S=D(),{loading:_,errorBag:u,hasError:g}=A(S),s=L(),{roleSelect:b}=A(s);s.getRoleSelect();const d=h,o=()=>d("close"),a=()=>{d("success"),d("reloadTable"),o()},V=()=>{d("error")},m=y({name:void 0,email:void 0,password:void 0,role:void 0}),C=B({get:()=>m.value.role??void 0,set:p=>m.value.role=p?Number(p):void 0}),i=async p=>{if(console.log(p.data),await S.addUser(p.data),g.value){V();return}a()};return(p,c)=>{const x=q,E=G,f=J,U=H,t=I,r=F;return R(),P(r,{"on-close":o,title:"Create User",ui:{width:"md:max-w-3xl"}},{default:v(()=>[l(t,{schema:"CreateUserValidationSchema"in p?p.CreateUserValidationSchema:e(ie),state:e(m),onSubmit:k(i,["prevent"]),class:"space-y-6"},{default:v(()=>[$("div",me,[l(E,{label:"Email",name:"email",error:e(u).email,ui:{wrapper:"md:w-full"}},{default:v(()=>[l(x,{modelValue:e(m).email,"onUpdate:modelValue":c[0]||(c[0]=n=>e(m).email=n)},null,8,["modelValue"])]),_:1},8,["error"]),l(E,{label:"Name",name:"name",error:e(u).name,ui:{wrapper:"md:w-full"}},{default:v(()=>[l(x,{modelValue:e(m).name,"onUpdate:modelValue":c[1]||(c[1]=n=>e(m).name=n)},null,8,["modelValue"])]),_:1},8,["error"]),l(E,{label:"Password",name:"password",error:e(u).password,ui:{wrapper:"md:w-full"}},{default:v(()=>[l(x,{modelValue:e(m).password,"onUpdate:modelValue":c[2]||(c[2]=n=>e(m).password=n),type:"password"},null,8,["modelValue"])]),_:1},8,["error"])]),$("div",pe,[l(E,{label:"Role",name:"role",error:e(u).role,ui:{wrapper:"md:w-full"}},{default:v(()=>[l(f,{modelValue:e(C),"onUpdate:modelValue":c[3]||(c[3]=n=>Z(C)?C.value=n:null),options:e(b),"value-attribute":"id","option-attribute":"title",placeholder:"Select"},null,8,["modelValue","options"])]),_:1},8,["error"])]),l(U,{type:"submit",loading:e(_)},{default:v(()=>[...c[4]||(c[4]=[j(" Add ",-1)])]),_:1},8,["loading"])]),_:1},8,["schema","state"])]),_:1})}}}),fe=Object.assign(Ue,{__name:"UsersCreateModal"}),_e={class:"space-y-6 md:space-y-0 md:flex md:space-x-6"},ve={class:"space-y-6 md:space-y-0 md:flex md:space-x-6"},ge={class:"space-y-6 md:space-y-0 md:flex md:space-x-6"},we=M({__name:"UpdateModal",props:{user:Object},emits:["reloadTable","success","error","noDataChange","close"],setup(w,{emit:h}){const S=D(),{loading:_,errorBag:u,hasError:g}=A(S),s=L(),{roleSelect:b}=A(s);s.getRoleSelect();const d=w,o=h,a=()=>o("close"),V=()=>{o("success"),o("reloadTable"),a()},m=()=>{o("error")},C=()=>{o("noDataChange")},i=y({email:d.user?.email??void 0,role:d.user?.roles[0].id??void 0,name:d.user?.name??void 0}),p=y(O.cloneDeep({email:d.user?.email??void 0,role:d.user?.roles[0].id??void 0,name:d.user?.name??void 0}));B({get:()=>i.value.role??void 0,set:f=>i.value.role=f?Number(f):void 0});const c=["email","role","name"],x=B(()=>c.some(f=>{const U=i.value[f],t=p.value[f];return!O.isEqual(U,t)})),E=async f=>{if(!x.value){C();return}if(await S.updateUser(d.user?.id,f.data),g.value){m();return}V()};return(f,U)=>{const t=q,r=G,n=J,z=H,X=I,Y=F;return R(),P(Y,{"on-close":a,title:"Edit User",ui:{width:"md:max-w-3xl"}},{default:v(()=>[l(X,{schema:"UpdateUserValidationSchema"in f?f.UpdateUserValidationSchema:e(ce),state:e(i),onSubmit:k(E,["prevent"]),class:"space-y-6"},{default:v(()=>[$("div",_e,[l(r,{label:"Email",name:"email",error:e(u).email,ui:{wrapper:"md:w-full"}},{default:v(()=>[l(t,{modelValue:e(i).email,"onUpdate:modelValue":U[0]||(U[0]=T=>e(i).email=T)},null,8,["modelValue"])]),_:1},8,["error"])]),$("div",ve,[l(r,{label:"Role",name:"role",error:e(u).role,ui:{wrapper:"md:w-full"}},{default:v(()=>[l(n,{modelValue:e(i).role,"onUpdate:modelValue":U[1]||(U[1]=T=>e(i).role=T),options:e(b),"value-attribute":"id","option-attribute":"title",placeholder:"Select"},null,8,["modelValue","options"])]),_:1},8,["error"])]),$("div",ge,[l(r,{label:"Name",name:"name",error:e(u).name,ui:{wrapper:"md:w-full"}},{default:v(()=>[l(t,{modelValue:e(i).name,"onUpdate:modelValue":U[2]||(U[2]=T=>e(i).name=T)},null,8,["modelValue"])]),_:1},8,["error"])]),l(z,{type:"submit",loading:e(_),disabled:!e(x)},{default:v(()=>[...U[3]||(U[3]=[j(" Update ",-1)])]),_:1},8,["loading","disabled"])]),_:1},8,["schema","state"])]),_:1})}}}),he=Object.assign(we,{__name:"UsersUpdateModal"}),Oe=M({__name:"index",setup(w){const h=ee();oe({title:()=>h.meta.title});const{strSingular:S}=ne();S(h.meta.title);const _=h.meta.title,u=te(),{actionToastResult:g}=le(),s=D(),{users:b,loading:d,page:o,pageCount:a,search:V,sort:m,totalUsers:C,selectedStatus:i}=A(s),{columns:p,items:c,statusOptions:x}=Q;s.fetchUsers();const E=()=>{u.open(fe,{onReloadTable(){s.fetchUsers()},onSuccess(){g({icon:"i-heroicons-check-circle",description:"User created.",id:"modal-success",color:"green"})},onError(){g({icon:"i-heroicons-x-circle",description:"Something went wrong.",id:"modal-error",color:"red"})},onClose(){u.close()}})},f=U=>{u.open(he,{user:U,onReloadTable(){s.fetchUsers()},onSuccess(){g({icon:"i-heroicons-check-circle",description:"User updated.",id:"modal-success",color:"green"})},onError(){g({icon:"i-heroicons-x-circle",description:"Something went wrong.",id:"modal-error",color:"red"})},onNoDataChange(){g({icon:"i-heroicons-exclamation-circle",description:"No data changes detected.",id:"modal-warning",color:"yellow"})},onClose(){u.close()}})};return N(V,()=>{o.value=1,s.fetchUsers()}),N(a,()=>{o.value=1,s.fetchUsers()}),N([o,a],()=>{s.fetchUsers()}),N(i,()=>{o.value=1,s.fetchUsers()}),(U,t)=>{const r=K;return R(),ae("div",null,[l(r,{"module-title":e(_),columns:e(p),"action-items":e(c),"table-data":e(b),"add-data-modal":E,loading:e(d),"action-handlers":{edit:f},pagination:{page:e(o),pageCount:e(a),total:e(C)},sorting:e(m),search:e(V),"selected-dropdown-filter":e(i),"enable-dropdown-filter":!0,"dropdown-filter-options":e(x),"onUpdate:page":t[0]||(t[0]=n=>o.value=n),"onUpdate:pageCount":t[1]||(t[1]=n=>a.value=n),"onUpdate:sort":e(s).fetchUsers,"onUpdate:search":t[2]||(t[2]=n=>V.value=n),"onUpdate:selectedDropdownFilter":t[3]||(t[3]=n=>i.value=n)},null,8,["module-title","columns","action-items","table-data","loading","action-handlers","pagination","sorting","search","selected-dropdown-filter","dropdown-filter-options","onUpdate:sort"])])}}});export{Oe as default};
